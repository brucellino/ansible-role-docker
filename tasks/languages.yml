---
- name: Copy requirements over
  copy:
    dest: /tmp/requirements.txt
    src: requirements.txt
    group: root
    owner: root
  tags:
    - pip
    - packages

- name: Ensure python global packages are present
  pip:
    requirements: "requirements.txt"
    chdir: /tmp
    state: present
  tags:
    - pip
    - packages

- name: Ensure that docker-py is absent
  pip:
    name: docker-py
    state: absent

- name: Ensure that bundler is present
  gem:
    name: bundler
    state: present

- name: Ensure Gemfiles are present
  copy:
    dest: "/tmp/{{ item }}"
    src: "{{ item }}"
    group: root
    owner: root
  loop:
    - Gemfile
  tags:
    - gems
    - packages

- name: bundle the gems
  bundler:
    gemfile: Gemfile
    state: present
    chdir: /tmp
  tags:
    - gems
    - packages
