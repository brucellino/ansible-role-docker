---
- name: Ensure global npm packages are present
  npm:
    name: "{{ item }}"
    global: true
    state: present
    production: true
  loop: "{{ npm.packages }}"
  tags:
    - npm
    - packages
- name: Copy requirements over
  copy:
    dest: /tmp/requirements.txt
    src: requirements.txt
    group: root
    owner: root
  tags:
    - pip
    - packages
- name: Ensure python global packages are present
  pip:
    requirements: "requirements.txt"
    chdir: /tmp
    state: present
  tags:
    - pip
    - packages
- name: Ensure that docker-py is absent
  pip:
    name: docker-py
    state: absent
- name: Ensure Gemfiles are present
  copy:
    dest: "/tmp/{{ item }}"
    src: "{{ item }}"
    group: root
    owner: root
  loop:
    - Gemfile
    - Gemfile.lock
  tags:
    - gems
    - packages
- name: bundle the gems
  bundler:
    gemfile: Gemfile
    clean: no
    user_install: yes
    state: present
    chdir: /tmp
  tags:
    - gems
    - packages
